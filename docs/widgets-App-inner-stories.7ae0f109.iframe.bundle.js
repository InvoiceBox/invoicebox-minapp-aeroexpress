"use strict";(self.webpackChunkinvoicebox_minapp_aeroexpress=self.webpackChunkinvoicebox_minapp_aeroexpress||[]).push([[371],{"./src/widgets/App/inner.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{InnerAvailableErrorFetch:()=>InnerAvailableErrorFetch,InnerAvailableRealFetchRealSubmit:()=>InnerAvailableRealFetchRealSubmit,InnerAvailableSuccessFetchErrorSubmit:()=>InnerAvailableSuccessFetchErrorSubmit,InnerAvailableSuccessFetchSuccessSubmit:()=>InnerAvailableSuccessFetchSuccessSubmit,InnerHeightByContainer:()=>InnerHeightByContainer,InnerUnavailable:()=>InnerUnavailable,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});var ___WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/widgets/App/index.tsx"),_network_http__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__("./src/index.css"),__webpack_require__("./src/network/http.ts")),_network_dummy__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/network/dummy.ts");const __WEBPACK_DEFAULT_EXPORT__={title:"widgets/App/_inner",component:___WEBPACK_IMPORTED_MODULE_0__.q,tags:["autodocs"]},defaultMocks={fetchTariffs:()=>new Promise((resolve=>{setTimeout((()=>{resolve(_network_dummy__WEBPACK_IMPORTED_MODULE_3__.E)}),1e3)})),createOrder:()=>new Promise((resolve=>{setTimeout((()=>{resolve({url:"/some-url",method:"GET"})}),1e3)}))},InnerAvailableRealFetchRealSubmit={args:{fetchTariffs:_network_http__WEBPACK_IMPORTED_MODULE_2__.P,createOrder:_network_http__WEBPACK_IMPORTED_MODULE_2__.M}},InnerAvailableSuccessFetchSuccessSubmit={args:defaultMocks},InnerUnavailable={args:defaultMocks},InnerAvailableErrorFetch={args:{...defaultMocks,fetchTariffs:()=>Promise.reject(new Error("error"))}},InnerAvailableSuccessFetchErrorSubmit={args:{...defaultMocks,createOrder:()=>Promise.reject(new Error("error"))}},InnerHeightByContainer={args:defaultMocks};InnerAvailableRealFetchRealSubmit.parameters={...InnerAvailableRealFetchRealSubmit.parameters,docs:{...InnerAvailableRealFetchRealSubmit.parameters?.docs,source:{originalSource:"{\n  args: {\n    fetchTariffs: fetchTariffsRequest,\n    createOrder: createOrderRequest\n  }\n}",...InnerAvailableRealFetchRealSubmit.parameters?.docs?.source}}},InnerAvailableSuccessFetchSuccessSubmit.parameters={...InnerAvailableSuccessFetchSuccessSubmit.parameters,docs:{...InnerAvailableSuccessFetchSuccessSubmit.parameters?.docs,source:{originalSource:"{\n  args: defaultMocks\n}",...InnerAvailableSuccessFetchSuccessSubmit.parameters?.docs?.source}}},InnerUnavailable.parameters={...InnerUnavailable.parameters,docs:{...InnerUnavailable.parameters?.docs,source:{originalSource:"{\n  args: defaultMocks\n}",...InnerUnavailable.parameters?.docs?.source}}},InnerAvailableErrorFetch.parameters={...InnerAvailableErrorFetch.parameters,docs:{...InnerAvailableErrorFetch.parameters?.docs,source:{originalSource:"{\n  args: {\n    ...defaultMocks,\n    fetchTariffs: () => Promise.reject(new Error('error'))\n  }\n}",...InnerAvailableErrorFetch.parameters?.docs?.source}}},InnerAvailableSuccessFetchErrorSubmit.parameters={...InnerAvailableSuccessFetchErrorSubmit.parameters,docs:{...InnerAvailableSuccessFetchErrorSubmit.parameters?.docs,source:{originalSource:"{\n  args: {\n    ...defaultMocks,\n    createOrder: () => Promise.reject(new Error('error'))\n  }\n}",...InnerAvailableSuccessFetchErrorSubmit.parameters?.docs?.source}}},InnerHeightByContainer.parameters={...InnerHeightByContainer.parameters,docs:{...InnerHeightByContainer.parameters?.docs,source:{originalSource:"{\n  args: defaultMocks\n}",...InnerHeightByContainer.parameters?.docs?.source}}};const __namedExportsOrder=["InnerAvailableRealFetchRealSubmit","InnerAvailableSuccessFetchSuccessSubmit","InnerUnavailable","InnerAvailableErrorFetch","InnerAvailableSuccessFetchErrorSubmit","InnerHeightByContainer"]},"./src/widgets/App/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{q:()=>App});var react=__webpack_require__("./node_modules/react/index.js"),dist=__webpack_require__("./node_modules/@invoicebox/ui/dist/index.js");var esm=__webpack_require__("./node_modules/@invoicebox/minapp-sdk/esm/index.js");const getHandler=handler=>function(){esm.u.isConnected()&&handler(...arguments)},handlers={handleError:getHandler(esm.u.onError.bind(esm.u)),handleHeightChange:getHandler(esm.u.onHeightChange.bind(esm.u)),handleUnavailable:getHandler(esm.u.onUnavailable.bind(esm.u)),handleDone:getHandler(esm.u.onDone.bind(esm.u)),handleLink:getHandler(esm.u.onLink.bind(esm.u))},MOSKOW_AIRPORTS=["VKO","DME","SVO"];var _templateObject,taggedTemplateLiteral=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js");const Wrapper=__webpack_require__("./node_modules/styled-components/dist/styled-components.browser.esm.js").default.div(_templateObject||(_templateObject=(0,taggedTemplateLiteral.A)(["\n    background-color: ",";\n"])),dist.VN.base);var Form=__webpack_require__("./src/components/Form/index.tsx");const ROUTES_tariffs="/tariffs";var envLogic=__webpack_require__("./src/network/envLogic.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const AppInner=_ref=>{let{initialData,tariffs,events,createOrder}=_ref;const{handleError,handleHeightChange,handleUnavailable,handleDone,handleLink:onLink}=events,setHeightElRef=((fullHeight,onHeightChange)=>{const[elRef,setElRef]=(0,react.useState)(null),handleHeightChange=(0,dist.zX)(onHeightChange);return(0,react.useEffect)((()=>{if(!elRef)return;if(fullHeight)return;const observer=new ResizeObserver((()=>{handleHeightChange(elRef.offsetHeight)}));return observer.observe(elRef),()=>observer.disconnect()}),[elRef,handleHeightChange,fullHeight]),(0,react.useEffect)((()=>{if(!elRef)return;if(!fullHeight)return;const resets=[];let currentElement=elRef;for(;currentElement;){const element=currentElement,{height}=element.style;resets.push((()=>{element.style.height=height})),element.style.height="100%",currentElement=element.parentElement}return()=>resets.forEach((reset=>reset()))}),[elRef,fullHeight]),setElRef})(initialData.fullHeight,handleHeightChange),isSuborder=(initialData=>"suborder"===initialData.minappType)(initialData);((onUnavailable,isSuborder)=>{const handleUnavailable=(0,dist.zX)(onUnavailable);(0,react.useEffect)((()=>{isSuborder&&esm.u.matchMetaDataValues("iataCode",MOSKOW_AIRPORTS).then((isMatch=>{isMatch||handleUnavailable()})).catch((()=>{}))}),[isSuborder,handleUnavailable])})(handleUnavailable,isSuborder);const handleSubmit=((initialData,onDone,onError,createOrder)=>(0,react.useCallback)((async form=>{const{orderContainerId,userName,userEmail,userPhone}=initialData;await createOrder({...form,orderContainerId,firstName:userName,email:userEmail,phone:userPhone}).then((response=>{onDone(response.url)})).catch((()=>onError()))}),[onDone,onError,initialData,createOrder]))(initialData,handleDone,handleError,createOrder),handleLink=(0,react.useCallback)((event=>{event.preventDefault();const{currentTarget}=event;onLink(currentTarget.getAttribute("href"))}),[onLink]),formKey=(0,react.useMemo)((()=>tariffs.map((_ref2=>{let{id}=_ref2;return id})).join("")),[tariffs]);return(0,jsx_runtime.jsx)(Wrapper,{ref:setHeightElRef,children:(0,jsx_runtime.jsx)(Form.l,{onSubmit:handleSubmit,initialTariffs:tariffs,onLink:handleLink,tariffsHref:envLogic.e.appendCurrentOrigin(ROUTES_tariffs),buttonText:isSuborder?"Добавить в заказ":"Купить билет"},formKey)})};AppInner.__docgenInfo={description:"",methods:[],displayName:"AppInner",props:{initialData:{required:!0,tsType:{name:"Awaited",elements:[{name:"ReturnType",elements:[{name:"invoiceboxMinapp.getInitialData"}],raw:"ReturnType<typeof invoiceboxMinapp.getInitialData>"}],raw:"Awaited<ReturnType<typeof invoiceboxMinapp.getInitialData>>"},description:""},tariffs:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{\n    id: number;\n    name: string;\n    description: string;\n    daysFrom: number;\n    daysTo: number;\n    seatsSelect: boolean;\n    active: boolean;\n    price: number;\n    maxTickets: number;\n    providerTariffId: number;\n    createdAt: string;\n}",signature:{properties:[{key:"id",value:{name:"number",required:!0}},{key:"name",value:{name:"string",required:!0}},{key:"description",value:{name:"string",required:!0}},{key:"daysFrom",value:{name:"number",required:!0}},{key:"daysTo",value:{name:"number",required:!0}},{key:"seatsSelect",value:{name:"boolean",required:!0}},{key:"active",value:{name:"boolean",required:!0}},{key:"price",value:{name:"number",required:!0}},{key:"maxTickets",value:{name:"number",required:!0}},{key:"providerTariffId",value:{name:"number",required:!0}},{key:"createdAt",value:{name:"string",required:!0}}]}}],raw:"TTariff[]"},description:""},events:{required:!0,tsType:{name:"handlers"},description:""},createOrder:{required:!0,tsType:{name:"createOrderRequest"},description:""}}};var Loader=__webpack_require__("./src/components/Loader/index.tsx");const App=_ref=>{let{fetchTariffs,createOrder}=_ref;(()=>{const connect=(0,react.useCallback)((()=>{esm.u.isConnected()||esm.u.connect()}),[]);(0,react.useEffect)((()=>(connect(),()=>{esm.u.disconnect()})),[connect])})();const events=handlers,{handleError}=events,initialData=(()=>{const[initialData,setInitialData]=(0,react.useState)(null);return(0,react.useEffect)((()=>{esm.u.getInitialData().then((resp=>setInitialData(resp))).catch((()=>{}))}),[]),initialData})(),{tariffs,isTariffsInitialized}=((onError,fetchTariffs)=>{const[tariffs,setTariffs]=(0,react.useState)([]),[isTariffsInitialized,setInitializedFlag]=(0,react.useState)(!1),handleError=(0,dist.zX)(onError),handleFetchTariffs=(0,dist.zX)(fetchTariffs);return(0,react.useEffect)((()=>{handleFetchTariffs().then(setTariffs).catch((()=>handleError())).finally((()=>setInitializedFlag(!0)))}),[handleError,handleFetchTariffs]),{tariffs,isTariffsInitialized}})(handleError,fetchTariffs);return isTariffsInitialized&&initialData?(0,jsx_runtime.jsx)(AppInner,{events,initialData,tariffs,createOrder}):(0,jsx_runtime.jsx)(Loader.a,{})};App.__docgenInfo={description:"",methods:[],displayName:"App",props:{fetchTariffs:{required:!0,tsType:{name:"fetchTariffsRequest"},description:""},createOrder:{required:!0,tsType:{name:"createOrderRequest"},description:""}}}}}]);